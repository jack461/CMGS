// Returns about 1000120
// Memory management test
// ~ 2533.823 ms
// ~ 59,011,468 inst.
var start = ptime();
var id = "T90";
var str90 = stralloc();
sprintf(str90, "%s-%d-Start [around: %d]", id, thread(`idt), 1000125);
GM_Log(str90);
strfree(str90);

var siz= 511, tp, ent, u, ma, mf;
tp = malloc(siz);
loop (2000000,
    ent = irand(siz);
    u = tp[ent];
    (u == 0) ? (
        tp[ent] = malloc(
                100 + irand(300));
        ma += 1;
    ) : (
        mfree(tp[ent]); tp[ent] = 0;
        mf += 1;
    );
);
ent = 0;
loop (siz,
    u = tp[ent];
    (u != 0) ? (
        mfree(tp[ent]); tp[ent] = 0;
        mf += 1;
    );
    ent += 1;
);


str90 = stralloc();
sprintf(str90, "%s-Duration:  %.4f s.", id, ptime() - start);
GM_Log(str90);
sprintf(str90, "%s-Result: %d", id, (ma == mf) && ma);
GM_Log(str90);

sprintf(str90, "%s-%d-End.", id, thread(`idt));
GM_Log(str90);

strfree(str90);


