/*
    
*/

var s = stralloc();
sprintf(s, "Test 44 - Start"); GM_Log(s);


// Try to read configuration 999 & 998
var ptconfs = get(`gm, `gHPPTab);
var ptc999 = gmem[ptconfs + 999];
sprintf(s, "HP Confs : %d  c999: %d   [%d %d %d %d %d ...]", ptconfs, ptc999,
      gmem[ptc999-1], gmem[ptc999], gmem[ptc999+1], gmem[ptc999+2], gmem[ptc999+3]);
GM_Log(s);
var ptc998 = gmem[ptconfs + 998];
sprintf(s, "HP Confs : %d  c998: %d   [%d %d %d %d %d ...]", ptconfs, ptc998,
     gmem[ptc998-1], gmem[ptc998], gmem[ptc998+1], gmem[ptc998+2], gmem[ptc998+3]);
GM_Log(s);



function setconf(cfn, str, s1, s2)
local (a, b, c, pt)
(
    a = get(`pval, s1);
    b = get(`pval, s2);
    c = 1 + abs(a-b);
    sprintf(str, "Conf: %d = %d [%d ... %d]", cfn, c, a, b);
    pt = gmem[ptconfs + cfn];
    gmem[pt] = c; pt += 1;
    (a > b) ? (
        while (a >= b) (gmem[pt] = a; a -= 1; pt += 1;);
    ) : (
        while (a <= b) (gmem[pt] = a; a += 1; pt += 1;);
    );
    gmem[pt] = 0;

);



var idx = get(`pnum, `VolGlob);
var sl0 = gui(`slider, idx);

idx = get(`pnum, `DynXPan);
var sl1 = gui(`slider, idx);

idx = get(`pnum, `XtndP0);
var sl01 = gui(`slider, idx);


var slpm = gui(`slider, 206, "Play mode", "plMd", 0x2000,  "%d",
       "Play mode: %d",    0,    64,  0,  1, 0);
var slsm = gui(`slider, 207, "Space mode", "spMd", 0x2000,  "%d",
       "Space mode: %d",    0,    64,  0,  1, 0);


var sl2 = gui(`slider, 200, "Cf1.start",  "cf1strt", 0x2000,  "%d", 
       "Cf1.start: %d",    1,    21,  1,  1, 0);
var sl3 = gui(`slider, 201, "Cf1.end",  "cf1end", 0x2000,  "%d", 
       "Cf1.end: %d",    1,    21,  1,  1, 0);


var sl4 = gui(`slider, 202, "Cf2.start",  "cf2strt", 0x2000,  "%d", 
       "Cf2.start: %d",    1,    21,  1,  1, 0);
var sl5 = gui(`slider, 203, "Cf2.end",  "cf2end", 0x2000,  "%d", 
       "Cf2.end: %d",    1,    21,  1,  1, 0);


var slrun = gui(`slider, 204,  "Run", "run", 0x2000, "%d",
        "Run: %d", 0, 1, 1, 1, 0);


var slplay = gui(`slider, 205,  "Play", "play", 0x2000, "%d",
        "Play: %d", 0, 1, 0, 1, 0);

gui(`update, `params);


var strb1 = stralloc();
var strb2 = stralloc();
var strb3 = stralloc();


var tbox1 = gui(`tbox, strb1);
var tbox2 = gui(`tbox, strb2);
var tbox3 = gui(`tbox, strb3);

strcpy(strb1, "HP Configurations");


var sbox1 = gui(`sbox, sl0, slpm, slsm, sl01, sl1);

var sbox2 = gui(`sbox, sl2, sl3);

var sbox3 = gui(`sbox, sl4, sl5);
var sbox4 = gui(`sbox, slrun, slplay);



var modu = gui(`module, sbox1, tbox1, sbox2, tbox2, sbox3, tbox3, sbox4);



//
 sprintf(s, "     sbox1 = %.4f   sbox2 = %.4f   modu = %.4f", sbox1, sbox2, modu); GM_Log(s);

var idt = "New module";
var num = 3;
var dcl = gui(`declare, modu, idt, num);

sprintf(s, "     module %d  \"%s\"  declared", dcl, idt); GM_Log(s);

var count = 0;
gui(`update, `modules);

while (get(`pval, 204)) (
    wait(1);
    setconf(998, strb2, 200, 201);
    setconf(999, strb3, 202, 203);
);


wait(1);

gui(`delete, `modules);
gui(`delete, `sliders);

/*
*/
GM_Log("Test 44 - End", " ");

strfree(s);
