/*
    Gauche/Droite par script
    Fréquence par X.par 0
*/

// Logique quasi identique à celle du test 32
var s = stralloc();
var k;

var clip = get(`gm, `cellAlt);


var x = get(`pval, 206);
var plmode = (x > 0) ? x : 0;

x = get(`pval, 207);
var spmode = (x > 0) ? x : 22;


sprintf(s, "Pan - Freq X.par0 - Start - Clip %04d  PM %d  SM %d", clip, plmode, spmode); GM_Log(s);

var w = 01; // wait

var stat = get(`gm, `cbStat);

var xp0 = get(`pnum, `XtndP0);
w = get(`pval, xp0);

// sprintf(s, "    vars: %d,  %f", stat, w); GM_Log(s);


var U = play(`clip, clip, `spmode, spmode, `plmode, plmode, `vol, 3, `unit);
wait(0.1);

while ((k = gmem[U + stat]) === 3) (
   wait(0.01);
);

wait(0.1);

k = gmem[U + stat];
sprintf(s, "    status = %d", k); GM_Log(s);


// On recupère la valeur du paramètre "XtndP0" à chaque changement de volume.
//  "XtndP0" varie de 0 à 10000. On interprète ceci comme une valeur en ms,
//  et on divise par 1000 pour obtenir une valeur en secondes attendues par "wait"
while ((k = gmem[U + stat ]) === 258) (

    // Volume 1 à gauche, 0 à droite
    call(`player, U, `KmdImm, 4, 1, 0, 2, 0);
    w = get(`pval, xp0) / 1000;
    wait(w);

    // Volume 0 à gauche, 1 à droite
    call(`player, U, `KmdImm, 4, 0, 1, 2, 0);
    w = get(`pval, xp0) / 1000;
    wait(w);
);



GM_Log("Pan - Freq X.par0 - fin", " ");

strfree(s);
